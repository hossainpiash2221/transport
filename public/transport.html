<!-- bus schedule complete -->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Campus360 - Transport</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.23/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    @keyframes fade-in-up {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in-up {
      animation: fade-in-up 0.8s ease-out forwards;
    }
    
    .steps .step:after {
      width: 3rem;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
  <style>
    @media (max-width: 768px) {
      section.h-screen > div {
        padding: 1rem;
      }
      section.h-screen h2 {
        font-size: 1.75rem; /* smaller than text-4xl */
      }
      section.h-screen p {
        font-size: 1rem; /* smaller than text-xl or text-2xl */
      }
      section.h-screen a {
        font-size: 0.875rem; /* smaller button text */
        padding: 0.5rem 1rem;
      }
    }
  </style>
</head>

<body class="bg-[#5800ff] text-white">
  <div class="bg-[url('bus_background.png')] bg-fixed bg-cover bg-center min-h-screen">
    <!-- Navbar -->
     <div class="navbar bg-[#300386] bg-opacity-75 fixed w-full z-40 shadow-md text-white">
      <div class="navbar-start">
        <div class="dropdown">
          <label tabindex="0" class="btn btn-ghost btn-circle md:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </label>
          <ul tabindex="0" class="menu menu-sm dropdown-content bg-[#300386] bg-opacity-95 rounded-box w-52 p-2 shadow mt-12">
            <li><a href="index.html" class="text-sm">Main Manu</a></li>
            <li><a href="cafeteria.html" class="text-sm">Cafeteria</a></li>
            <li><a href="trackBus.html" class="text-sm">Transport</a></li>
            <li><a href="#clubs" class="text-sm">Clubs</a></li>
            <li><a href="#communication" class="text-sm">Communication Hub</a></li>
          </ul>
        </div>
        <h1 class="text-xl hidden md:block font-bold flex items-center space-x-1 md:space-x-2">
          <span>Campus</span>
          <span class="text-red-500 text-2xl md:text-3xl">360</span>
          <hr class="border-white border-l-2 h-5 inline-block" />
          <span class="ml-1 md:ml-2 text-sm md:text-base">Solution</span>
        </h1>
      </div>
      <div class="navbar-center hidden md:flex">
        <ul class="menu menu-horizontal px-1 space-x-4 text-sm md:text-base">
          <li><a href="index.html" class="hover:text-gray-300">Main Manu</a></li>
          <li><a href="cafeteria.html" class="hover:text-gray-300">Cafeteria</a></li>
          <li><a href="trackBus.html" class="hover:text-gray-300">Transport</a></li>
          <li><a href="#clubs" class="hover:text-gray-300">Clubs</a></li>
          <li><a href="#communication" class="hover:text-gray-300">Communication Hub</a></li>
        </ul>
      </div>
      <div class="navbar-end flex space-x-2">
        <!-- <button class="btn btn-ghost btn-circle p-0">
          <img class="w-5" src="search.gif" alt="search" />
        </button> -->
        <!-- <button>Login</button>
        <button class="btn btn-outline glass text-white">Register Now</button> -->
        
        <a href="transport.html" class="btn btn-outline text-white hover:text-gray-300 text-sm md:text-base">View Transport</a>
        <a href="http://localhost:5173/" class="btn btn-outline text-white hover:text-gray-300 text-sm md:text-base">Log out</a>
      </div>
    </div>

    <!-- Transport Overview -->
    <section class="h-screen flex items-center justify-center text-center pt-16">
      <div class="bg-[#5800ff] bg-opacity-75 p-10 rounded-lg animate-fade-in-up">
        <h2 class="text-4xl font-bold">University Transport Management</h2>
        <p class="mt-4 text-xl">Track bus availability, schedules, and student polls.</p>
        <p id="transport-status" class="mt-4 text-grey-300 text-2xl font-semibold">Loading seat availability...</p>
        <a href="#features"
          class="mt-6 inline-block px-6 py-3 bg-blue-500 hover:bg-blue-700 rounded-lg text-white">Explore Features</a>
      </div>
    </section>

    <!-- Feature Cards -->
    <section id="features" class=" mx-auto p-10 bg-[#5800ff] bg-opacity-75">
      <h4 class="text-4xl font-bold text-center mb-10">Transport Features</h4>
      <div class="flex flex-wrap gap-8 justify-center">
        <!-- Track Bus Feature -->
        <div class="card glass w-80">
          <figure><img src="bustrack.png" alt="Track Bus" class="h-72 w-full object-cover" /></figure>
          <div class="card-body">
            <h2 class="card-title">Track Bus</h2>
            <p>Monitor real-time location of buses with live GPS updates.</p>
            <div class="card-actions justify-end">
              <button class="btn btn-primary" onclick="loadBusTrackingModal()">Track Now</button>
            </div>
          </div>
        </div>

        <!-- Bus Schedule Feature -->
        <div class="card glass w-80">
          <figure><img src="schedule.png" alt="Bus Schedule" class="h-72 w-full object-cover" /></figure>
          <div class="card-body">
            <h2 class="card-title">Bus Schedule</h2>
            <p>View current and upcoming transport schedules organized by routes and times.</p>
            <div class="card-actions justify-end">
              <button class="btn btn-primary" onclick="loadScheduleModal()">View Schedule</button>
            </div>
          </div>
        </div>

        <!-- Transport Poll Feature -->
        <div class="card glass w-80">
          <figure><img src="transportPoll.png" alt="Transport Poll" class="h-72 w-full object-cover" /></figure>
          <div class="card-body">
            <h2 class="card-title">Transport Poll</h2>
            <p>Participate in polls to help optimize transport resources based on student demand.</p>
            <div class="card-actions justify-end">
              <button class="btn btn-primary" onclick="loadPollModal()">Vote Now</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Bus Tracking Modal -->
    <dialog id="busMapModal" class="modal">
      <div class="modal-box w-11/12 max-w-5xl bg-[#5800ff] glass text-white">
        <h3 class="font-bold text-lg mb-4">Live Bus Map</h3>
        
        <!-- Filter Controls -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div>
            <label for="routeFilter" class="block mb-2 font-semibold">Filter by Route:</label>
            <select id="routeFilter" class="select select-bordered w-full text-gray-600">
              <option selected value="all">All Routes</option>
              <!-- Routes will be loaded here -->
            </select>
          </div>
          <div>
            <label for="timeFilter" class="block mb-2 font-semibold">Filter by Time:</label>
            <select id="timeFilter" class="select select-bordered w-full text-gray-600">
              <option selected value="all">All Times</option>
              <option value="morning">Morning (6AM-12PM)</option>
              <option value="afternoon">Afternoon (12PM-6PM)</option>
              <option value="evening">Evening (6PM-12AM)</option>
            </select>
          </div>
          <div>
            <label for="statusFilter" class="block mb-2 font-semibold">Filter by Status:</label>
            <select id="statusFilter" class="select select-bordered w-full text-gray-600">
              <option selected value="all">All Statuses</option>
              <option value="On Route">On Route</option>
              <option value="Delayed">Delayed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>
        </div>

        <!-- Combined Map View -->
        <div class="mb-6">
          <h4 class="text-md font-semibold mb-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
            </svg>
            Combined Map - All Active Buses
          </h4>
          <div class="bg-gray-200 rounded-lg p-1">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d3650.255876567328!2d90.3905!3d23.8306!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sbd!4v1714000000000!5m2!1sen!2sbd"
              width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" class="rounded-lg">
            </iframe>
          </div>
        </div>

        <!-- Individual Bus Cards -->
        <div id="busContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto p-2">
          <!-- Buses will be loaded here -->
          <div class="skeleton h-32 w-full"></div>
          <div class="skeleton h-32 w-full"></div>
        </div>

        <div class="modal-action mt-6">
          <form method="dialog">
            <button class="btn">Close</button>
          </form>
        </div>
      </div>
    </dialog>

    <!-- Schedule Modal -->
    <dialog id="scheduleModal" class="modal">
      <div class="modal-box w-11/12 max-w-7xl bg-[#5800ff] glass text-white">
        <h2 class="text-4xl font-bold text-center mb-8">üóìÔ∏è Bus Schedule</h2>

        <!-- Filter Controls -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block font-semibold mb-1">Your Pickup Location:</label>
            <select id="pickupLocation" class="select select-bordered w-full text-gray-600">
              <option disabled selected>Select your pickup location</option>
              <!-- Locations will be loaded here -->
            </select>
          </div>
          <div>
            <label class="block font-semibold mb-1">Preferred Time:</label>
            <input type="time" id="preferredTime" class="input input-bordered w-full text-gray-600">
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div>
            <label class="block font-semibold mb-1">ID:</label>
            <input type="text" id="userId" class="input input-bordered w-full text-gray-600" placeholder="Enter your ID">
          </div>
          <div>
            <label class="block font-semibold mb-1">Name:</label>
            <input type="text" id="userName" class="input input-bordered w-full text-gray-600" placeholder="Enter your name">
          </div>
          <div>
            <label class="block font-semibold mb-1">Bus Number:</label>
            <select id="busNumber" class="select select-bordered w-full text-gray-600">
              <option disabled selected>Select your bus number</option>
              <!-- Bus numbers will be loaded here -->
            </select>
          </div>
        </div>
        <div class="modal-action mt-6">
          <button id="pickMeButton" class="btn btn-primary">Pick Me</button>
          <form method="dialog">
            <button class="btn">Close</button>
          </form>
        </div>

        <!-- Schedule Table -->
        <div class="overflow-x-auto">
          <table class="table w-full">
            <thead>
              <tr class="bg-[#5800ff] text-white">
                <th>Bus</th>
                <th>Route</th>
                <th>Departure</th>
                <th>Arrival</th>
                <th>Driver</th>
                <th>Available</th>
                <th>Status</th>
                <th>Path</th>
              </tr>
            </thead>
            <tbody id="scheduleTableBody" class="bg-[#5800ff]">
              <!-- Schedules will be loaded here -->
              <tr>
                <td colspan="8" class="text-center py-4">Loading schedule data...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="modal-action mt-6">
          <form method="dialog">
            <button class="btn">Close</button>
          </form>
        </div>
      </div>
    </dialog>

    <!-- Poll Modal -->
    <dialog id="pollModal" class="modal">
      <div class="modal-box w-11/12 max-w-3xl bg-[#5800ff] glass text-white">
        <h2 class="text-3xl font-bold text-center mb-6">Transport Feedback Poll</h2>
        
        <div class="space-y-6">
          <div>
            <h3 class="text-xl font-semibold mb-3">How satisfied are you with the bus service?</h3>
            <div class="flex flex-wrap gap-2">
              <button class="btn btn-sm" onclick="vote('satisfaction', 'very-satisfied')">Very Satisfied</button>
              <button class="btn btn-sm" onclick="vote('satisfaction', 'satisfied')">Satisfied</button>
              <button class="btn btn-sm" onclick="vote('satisfaction', 'neutral')">Neutral</button>
              <button class="btn btn-sm" onclick="vote('satisfaction', 'dissatisfied')">Dissatisfied</button>
              <button class="btn btn-sm" onclick="vote('satisfaction', 'very-dissatisfied')">Very Dissatisfied</button>
            </div>
          </div>
          
          <div>
            <h3 class="text-xl font-semibold mb-3">How often do you use the bus service?</h3>
            <div class="flex flex-wrap gap-2">
              <button class="btn btn-sm" onclick="vote('frequency', 'daily')">Daily</button>
              <button class="btn btn-sm" onclick="vote('frequency', 'weekly')">Weekly</button>
              <button class="btn btn-sm" onclick="vote('frequency', 'monthly')">Monthly</button>
              <button class="btn btn-sm" onclick="vote('frequency', 'rarely')">Rarely</button>
            </div>
          </div>
          
          <div>
            <h3 class="text-xl font-semibold mb-3">What improvements would you suggest?</h3>
            <textarea id="suggestions" class="textarea textarea-bordered w-full text-gray-600" placeholder="Your suggestions..."></textarea>
            <button class="btn btn-primary mt-2" onclick="submitSuggestions()">Submit Suggestions</button>
          </div>
        </div>

        <div class="modal-action mt-6">
          <form method="dialog">
            <button class="btn">Close</button>
          </form>
        </div>
      </div>
    </dialog>
  </div>

   <hr class="mt-10">
    <section class="container mx-auto">
      <footer class="footer text-white p-10 justify-evenly grid-cols-2">
        <nav>
          <h6 class="footer-title">Services</h6>
          <a class="link link-hover">Branding</a>
          <a class="link link-hover">Design</a>
          <a class="link link-hover">Marketing</a>
          <a class="link link-hover">Advertisement</a>
        </nav>
        <nav>
          <h6 class="footer-title">Company</h6>
          <a class="link link-hover">About us</a>
          <a class="link link-hover">Contact</a>
          <a class="link link-hover">Jobs</a>
          <a class="link link-hover">Press kit</a>
        </nav>
        <nav>
          <h6 class="footer-title">Legal</h6>
          <a class="link link-hover">Terms of use</a>
          <a class="link link-hover">Privacy policy</a>
          <a class="link link-hover">Cookie policy</a>
        </nav>
      </footer>
      <footer class="footer  border-base-300 border-t px-10 py-4">
        <aside class="grid-flow-col items-center">
          <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd"
            clip-rule="evenodd" class="fill-current">
            <path
              d="M22.672 15.226l-2.432.811.841 2.515c.33 1.019-.209 2.127-1.23 2.456-1.15.325-2.148-.321-2.463-1.226l-.84-2.518-5.013 1.677.84 2.517c.391 1.203-.434 2.542-1.831 2.542-.88 0-1.601-.564-1.86-1.314l-.842-2.516-2.431.809c-1.135.328-2.145-.317-2.463-1.229-.329-1.018.211-2.127 1.231-2.456l2.432-.809-1.621-4.823-2.432.808c-1.355.384-2.558-.59-2.558-1.839 0-.817.509-1.582 1.327-1.846l2.433-.809-.842-2.515c-.33-1.02.211-2.129 1.232-2.458 1.02-.329 2.13.209 2.461 1.229l.842 2.515 5.011-1.677-.839-2.517c-.403-1.238.484-2.553 1.843-2.553.819 0 1.585.509 1.85 1.326l.841 2.517 2.431-.81c1.02-.33 2.131.211 2.461 1.229.332 1.018-.21 2.126-1.23 2.456l-2.433.809 1.622 4.823 2.433-.809c1.242-.401 2.557.484 2.557 1.838 0 .819-.51 1.583-1.328 1.847m-8.992-6.428l-5.01 1.675 1.619 4.828 5.011-1.674-1.62-4.829z">
            </path>
          </svg>
          <p>
            ACME Industries Ltd.
            <br />
            Providing reliable tech since 1992
          </p>
        </aside>
        <nav class="md:place-self-center md:justify-self-end">
          <div class="grid grid-flow-col gap-4">
            <a>
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current">
                <path
                  d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z">
                </path>
              </svg>
            </a>
            <a>
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current">
                <path
                  d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z">
                </path>
              </svg>
            </a>
            <a>
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current">
                <path
                  d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z">
                </path>
              </svg>
            </a>
          </div>
        </nav>
      </footer>
    </section>

  <script>
    // Connect to Socket.IO server
    const socket = io();
    let transportData = {
      routes: [],
      schedules: [],
      busLocations: []
    };

    document.addEventListener("DOMContentLoaded", function() {
      // Get initial data from server
      socket.on('initialData', (data) => {
        transportData = data;
        updateSeatAvailability();
        // Removed automatic modal opening on page load
        // loadBusTrackingModal();
        // loadScheduleModal();
      });

      // Listen for updates from server
      socket.on('routesUpdated', (routes) => {
        transportData.routes = routes;
        // Removed automatic modal opening on data update
        // loadScheduleModal();
      });
      
      socket.on('schedulesUpdated', (schedules) => {
        transportData.schedules = schedules;
        updateSeatAvailability();
        // Removed automatic modal opening on data update
        // loadBusTrackingModal();
        // loadScheduleModal();
      });
      
      socket.on('busLocationUpdated', (update) => {
        const { busId, location, availableSeats, status, busNumber, routeName } = update;
        
        // Update in schedules
        const scheduleIndex = transportData.schedules.findIndex(s => s.id === busId);
        if (scheduleIndex !== -1) {
          transportData.schedules[scheduleIndex].availableSeats = availableSeats;
          transportData.schedules[scheduleIndex].status = status;
        }
        
        // Update in busLocations
        const existingIndex = transportData.busLocations.findIndex(b => b.busId === busId);
        if (existingIndex !== -1) {
          transportData.busLocations[existingIndex] = {
            ...transportData.busLocations[existingIndex],
            location,
            availableSeats,
            status,
            busNumber: busNumber || transportData.busLocations[existingIndex].busNumber,
            routeName: routeName || transportData.busLocations[existingIndex].routeName
          };
        } else {
          transportData.busLocations.push({
            busId,
            busNumber,
            routeName,
            location,
            availableSeats,
            status
          });
        }
        
        updateSeatAvailability();
        // Removed automatic modal reload on location update
        // if (document.getElementById('busMapModal').open) {
        //   loadBusTrackingModal();
        // }
        // if (document.getElementById('scheduleModal').open) {
        //   loadScheduleModal();
        // }
      });

      // Update available seats display
      function updateSeatAvailability() {
        const transportStatus = document.getElementById("transport-status");
        if (transportStatus) {
          const totalAvailable = transportData.busLocations.reduce(
            (sum, bus) => sum + (bus.availableSeats || 0), 0
          );
          transportStatus.textContent = `Available bus seats: ${totalAvailable}`;
        }
      }

      // Initial update
      updateSeatAvailability();
    });

    function loadBusTrackingModal() {
      const busMapModal = document.getElementById('busMapModal');
      if (!busMapModal.open) busMapModal.showModal();
      
      const routeFilter = document.getElementById('routeFilter');
      const busContainer = document.getElementById('busContainer');
      
      // Clear existing options
      routeFilter.innerHTML = '<option value="all">All Routes</option>';
      busContainer.innerHTML = '';
      
      // Load route filter options
      transportData.routes.forEach(route => {
        const option = document.createElement('option');
        option.value = route.id;
        option.textContent = `${route.name} (${route.bus})`;
        routeFilter.appendChild(option);
      });
      
      // Load bus cards
      transportData.busLocations.forEach(bus => {
        const schedule = transportData.schedules.find(s => s.id === bus.busId);
        const route = transportData.routes.find(r => r.id === (schedule?.routeId || bus.routeId));
        
        if (route) {
          const stops = route.stops.split(',').map(s => s.trim());
          const currentStopIndex = stops.findIndex(s => 
            s.includes(bus.location) || s.startsWith(bus.location)
          );
          
          const busCard = document.createElement('div');
          busCard.className = 'card bg-base-100 shadow-xl';
          busCard.dataset.route = route.id;
          busCard.dataset.time = schedule?.departure?.includes('AM') ? 'morning' : 
                               schedule?.departure?.includes('PM') ? 'afternoon' : 'all';
          busCard.dataset.status = bus.status;
          
          busCard.innerHTML = `
            <div class="card-body">
              <div class="flex justify-between items-start">
                <h2 class="card-title">
                  ${schedule?.bus || bus.busNumber || 'Bus N/A'}
                  <span class="badge  ${getStatusBadgeClass(bus.status)}">
                    ${bus.status || 'N/A'}
                  </span>
                </h2>
                <span class="text-sm opacity-70">${route.name}</span>
              </div>
              
              <div class="grid grid-cols-2 gap-4 mt-2">
                <div>
                  <p class="text-sm"><strong>Current Location:</strong></p>
                  <p class="font-bold">${bus.location || 'N/A'}</p>
                </div>
                <div>
                  <p class="text-sm"><strong>Available Seats:</strong></p>
                  <p class="font-bold">${bus.availableSeats || '0'}</p>
                </div>
              </div>
              
              <div class="mt-2">
                <p class="text-sm"><strong>Next Stop:</strong></p>
                <p>${currentStopIndex < stops.length - 1 ? 
                  stops[currentStopIndex + 1].split('@')[0].trim() : 'Final stop'}</p>
              </div>
              
              <div class="card-actions justify-end mt-2">
                <button class="btn btn-sm btn-primary">View Details</button>
              </div>
            </div>
          `;
          busContainer.appendChild(busCard);
        }
      });
      
      // Set up filter functionality
      function applyFilters() {
        const route = routeFilter.value;
        const time = document.getElementById('timeFilter').value;
        const status = document.getElementById('statusFilter').value;
        
        document.querySelectorAll('#busContainer > div').forEach(card => {
          const matchesRoute = route === "all" || card.dataset.route === route;
          const matchesTime = time === "all" || card.dataset.time === time;
          const matchesStatus = status === "all" || card.dataset.status === status;
          
          card.style.display = matchesRoute && matchesTime && matchesStatus ? "block" : "none";
        });
      }
      
      routeFilter.addEventListener('change', applyFilters);
      document.getElementById('timeFilter').addEventListener('change', applyFilters);
      document.getElementById('statusFilter').addEventListener('change', applyFilters);
    }

    function loadScheduleModal() {
      const scheduleModal = document.getElementById('scheduleModal');
      if (!scheduleModal.open) scheduleModal.showModal();
      
      const pickupLocation = document.getElementById('pickupLocation');
      const scheduleTableBody = document.getElementById('scheduleTableBody');
      const busNumberSelect = document.getElementById('busNumber');
      
      // Clear existing options
      pickupLocation.innerHTML = '<option disabled selected>Select your pickup location</option>';
      scheduleTableBody.innerHTML = '';
      busNumberSelect.innerHTML = '<option disabled selected>Select your bus number</option>';
      
      // Collect all unique locations from routes
      const allLocations = new Set();
      transportData.routes.forEach(route => {
        route.stops.split(',').forEach(stop => {
          allLocations.add(stop.split('@')[0].trim());
        });
      });
      
      // Add locations to pickup selector
      allLocations.forEach(location => {
        const option = document.createElement('option');
        option.value = location;
        option.textContent = location;
        pickupLocation.appendChild(option);
      });
      
      // Add bus numbers to busNumber select from schedules (admin assigned buses)
      transportData.schedules.forEach(schedule => {
        const option = document.createElement('option');
        option.value = schedule.bus;
        option.textContent = schedule.bus;
        busNumberSelect.appendChild(option);
      });
      
      // Load schedule table
      transportData.schedules.forEach(schedule => {
        const route = transportData.routes.find(r => r.id === schedule.routeId);
        const busLocation = transportData.busLocations.find(b => b.busId === schedule.id);
        
        if (route) {
          const stops = route.stops.split(',').map(s => s.trim());
          const steps = stops.map((stop, index) => {
            const [stopName, stopTime] = stop.split('@');
            const isCompleted = busLocation && stops.slice(0, index).some(s => 
              s.includes(busLocation.location) || s.startsWith(busLocation.location)
            );
            return `
              <li class="step ${isCompleted ? '' : 'step-primary'}" 
                  data-content="${stopTime || ''}">
                ${stopName.trim()}
              </li>
            `;
          }).join('');
          
          const row = document.createElement('tr');
          row.className = busLocation?.status === 'Cancelled' ? 'hover bg-red-500' : 
                         busLocation?.status === 'Delayed' ? 'hover bg-yellow-500' : 'hover:bg-blue-700 glass';
          
          row.innerHTML = `
            <td>${schedule.bus}</td>
            <td>${route.name}</td>
            <td>${schedule.departure}</td>
            <td>${schedule.arrival}</td>
            <td>
              <div class="flex flex-col">
                <span>${schedule.driver}</span>
                <span class="text-xs opacity-70">${schedule.contact}</span>
              </div>
            </td>
            <td>${busLocation?.availableSeats || schedule.availableSeats}</td>
            <td>
              <span class="badge ${getStatusBadgeClass(busLocation?.status || schedule.status)}">
                ${busLocation?.status || schedule.status}
              </span>
            </td>
            <td>
              <ul class="steps">
                ${steps}
                
              </ul>
            </td>
          `;
          scheduleTableBody.appendChild(row);
        }
      });
    }

    function loadPollModal() {
      const pollModal = document.getElementById('pollModal');
      if (!pollModal.open) pollModal.showModal();
    }

    function vote(pollName, option) {
      socket.emit('vote', { pollName, option });
      alert(`Thank you for your vote on ${pollName}!`);
    }

    function submitSuggestions() {
      const suggestions = document.getElementById('suggestions').value;
      if (suggestions.trim()) {
        socket.emit('submitSuggestions', { suggestions });
        alert('Thank you for your suggestions!');
        document.getElementById('suggestions').value = '';
      } else {
        alert('Please enter your suggestions before submitting.');
      }
    }

    function getStatusBadgeClass(status) {
      switch(status) {
        case 'On Route': return 'badge-success';
        case 'Delayed': return 'badge-warning';
        case 'Cancelled': return 'badge-error';
        default: return 'badge-info';
      }
    }
  </script>
  <script>
    // Handle Pick Me button click
    document.getElementById('pickMeButton').addEventListener('click', function() {
      const userId = document.getElementById('userId').value.trim();
      const userName = document.getElementById('userName').value.trim();
      const busNumber = document.getElementById('busNumber').value;
      const pickupLocation = document.getElementById('pickupLocation').value;
      const preferredTime = document.getElementById('preferredTime').value;

      if (!userId || !userName || !busNumber || !pickupLocation || !preferredTime) {
        alert('Please fill in all fields before submitting.');
        return;
      }

      // Create pickup request object
      const pickupRequest = {
        id: userId,
        name: userName,
        busNumber: busNumber,
        pickupLocation: pickupLocation,
        preferredTime: preferredTime
      };

      // Send pickup request to backend via socket.io
      socket.emit('pickupRequest', pickupRequest);

      alert('Pickup request sent successfully!');

      // Optionally close the modal
      const scheduleModal = document.getElementById('scheduleModal');
      if (scheduleModal.open) scheduleModal.close();

      // Clear inputs
      document.getElementById('userId').value = '';
      document.getElementById('userName').value = '';
      document.getElementById('busNumber').value = '';
      document.getElementById('pickupLocation').value = '';
      document.getElementById('preferredTime').value = '';
    });
  </script>
</body>
</html>
